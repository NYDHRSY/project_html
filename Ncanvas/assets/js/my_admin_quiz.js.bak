var uid = 1024;
var cid = 100;


function renderAdminQuizlist(data_url,add_url,del_url) {
    data_url = "../php/student_quiz_list.php";
    add_url = "../php/add_quiz.php";
    del_url = "../php/del_quiz.php";

    var namelist = ["tname","tid","type","due"];
    var maxid = 0;



    loadDataUser(data_url);
    function loadDataUser(url) {
        let xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function () {
            if (xmlHttp.readyState===4 && xmlHttp.status===200)
            {
                let data=xmlHttp.responseText;
                console.log(data);
                data = JSON.parse(data);
                console.log(data);
                createQuizList(data);
            }
        };
        xmlHttp.open("GET",url+"?action=get_quiz_list&uid="+uid+"&cid="+cid,true);
        xmlHttp.send();
    }
    function createQuizList(data) {
        /*data json*/
        for(var i in data){
            if(data.hasOwnProperty(i)){
                let quiz = data[i];
                let qltname = quiz.tname;
                let qltid = quiz.tid;
                let qldue = quiz.due;
                let qltype = (quiz.QA.length===0)?"sub":"obj";
                if(maxid<parseInt(qltid)){maxid = parseInt(qltid)}
                "objective";"subjective";
                $("#quiz-list-add-btn-row").before("" +
                    "<tr id=\""+qltid+"-row\">\n" +
                    "<th scope=\"row\" class=\"name\">\n" +
                    "<a href=\"#t"+qltid+"-question-form\" class=\"text-purple quiz-link text-sm my-editable\" data-toggle=\"collapse\" role=\"button\" aria-expanded=\"false\" aria-controls=\"collapseExample\">" +
                    qltname +
                    "</a>\n" +
                    "</th>" +
                    "<td class='tid my-editable'>" +
                    qltid +
                    "</td>" +
                    "<td class='type my-editable text-capitalize'>" +
                    qltype +
                    "</td>"+
                    "<td class=\"due my-editable\">" +
                    qldue +
                    "</td>\n" +
                    "<td class=\"edit-container\" style=\"width: 15rem\">\n" +
                    "<button id=\""+qltid+"-edt-btn\" type=\"button\" class=\"btn btn-sm bg-blue px-3 text-white my-edt-btn\">Edit</button>\n" +
                    "<button id=\""+qltid+"-del-btn\" type=\"button\" class=\"btn btn-sm bg-red px-3 text-white my-del-btn\">Delete</button>\n" +
                    "</td>\n" +
                    "</tr>"

                );
                $("#quiz-list-add-btn-row").before("" +
                    "<tr class=\"border-bottom-0 "+qltype+"-question-row\" id=\""+qltid+"-question-row\">\n" +
                    "    <td colspan=\"5\" class=\"p-0 border-top-0\">\n" +
                    "        <form class=\"collapse\" action=\"\" id=\"t"+qltid+"-question-form\">\n" +
                    "            <button id=\""+qltid+"-question-list-add-btn\" type=\"button\" class=\"btn btn-sm mx-4 mb-3 text-white bg-gray question-list-add-btn "+qltype+"-question-list-add-btn\" >Add New Question</button>" +
                    "        </form>\n" +
                    "    </td>\n" +
                    "</tr>"
                );
                /*render mul type*/
                let qlqa = quiz.QA;
                let question_list = [];
                for(var j in qlqa){
                    if(qlqa.hasOwnProperty(j)){
                        let question = qlqa[j];
                        let title = question.title;
                        let choice = [question.choiceA,question.choiceB,question.choiceC,question.choiceD];
                        let std = question.std;
                        question_list.push("" +
                            "<hr class=\"m-0 mx-3\">\n" +
                            "<div class=\"card-body py-3 question-container obj-question\">" +
                            "<span class='my-editable my-editable-obj-title'>" +
                            title +
                            "</span>\n" +
                            "<div class=\" mt-2 choice-container\">\n" +
                            // "<div id=\""+qltid+"-0\" class=\"my-editable my-editable-obj-choice\">" +
                            "<div class=\"my-editable my-editable-obj-choice\">" +
                            ""+choice[0]+
                            "</div>\n" +
                            "<div class=\"my-editable my-editable-obj-choice\">" +
                            ""+choice[1]+
                            "</div>\n" +
                            "<div class=\"my-editable my-editable-obj-choice\">" +
                            ""+choice[2]+
                            "</div>\n" +
                            "<div class=\"my-editable my-editable-obj-choice\">" +
                            ""+choice[3]+
                            "</div>\n" +
                            "<div class=\"mt-2 my-editable my-editable-obj-choice my-editable-obj-std\">" +
                            ""+std+
                            "</div>\n" +
                            "</div>\n" +
                            "</div>"
                        );
                    }
                }
                $("#"+qltid+"-question-list-add-btn").before(question_list);

                /*render file type*/
                let qlqb = quiz.QB;
                console.log(qlqb);
                question_list = [];
                for(j in qlqb){
                    if(qlqb.hasOwnProperty(j)){
                        let question = qlqb[j];
                        let title = question.title;
                        question_list.push("" +
                            "<hr class=\"m-0 mx-3\">" +
                            "<div class=\"card-body py-3 question-container sub-question\">" +
                            "<span class='my-editable my-editable-sub-title'>" +
                            title +
                            "</span>" +
                            "</div>"
                        );
                    }
                }
                $("#"+qltid+"-question-list-add-btn").before(question_list);

            }
        }
        $(".question-list-add-btn").hide();
        /*全局设定*/
        $("#quiz-table .my-edt-btn").on("click",function () {
            let id = this.id.slice(0,-8);
            console.log(id);
            /*点击了edit*/
            if($(this).html()==="Edit"){
                $("#"+id+"-row .my-editable").each(function (i) {
                    var value = $(this).html();
                    $(this).html("" +
                        "<input type='text' name=\""+ namelist[i] +"\" class='text' value=\""+ value +"\">"
                    );
                });
                /*QA naming*/
                var qa_namelist = ["title","choiceA","choiceB","choiceC","choiceD","std"];
                $("#"+id+"-question-row.obj-question-row .my-editable").each(function (i) {
                    var value = $(this).html();
                    // var name = "";
                    // // !!!uhzndskflrewqey98734y1iuhad"siufhaln;kdshcdhfcmm
                    // name = $(this).attr("id");
                    // console.log(value);
                    $(this).html("" +
                        "<input type='text' name=\""+ qa_namelist[i%6] +"\" class='text' value=\""+ value +"\">"
                    );
                });
                /*QB naming*/
                var qb_namelist = ["title"];
                $("#"+id+"-question-row.sub-question-row .my-editable").each(function (i) {
                    var value = $(this).html();
                    // var name = "";
                    // // !!!uhzndskflrewqey98734y1iuhad"siufhaln;kdshcdhfcmm
                    // name = $(this).attr("id");
                    // console.log(value);
                    $(this).html("" +
                        "<input type='text' name=\""+ qa_namelist[i%1] +"\" class='text' value=\""+ value +"\">"
                    );
                });
                /*button changing*/
                $("#"+id+"-row input[name='tid']").attr("readonly",true);
                $("#"+id+"-row input[name='type']").attr("readonly",true);
                $("#"+id+"-row [data-toggle='collapse']").attr("href","#");
                $("#t"+id+"-question-form").attr({"readonly":true}).toggleClass("show",true);
                $("#"+id+"-row .my-del-btn").hide();
                $("#"+id+"-question-list-add-btn").show();
                $(this).html("Save").toggleClass("bg-orange");
            }
            /*点击了save*/
            else {
                let json = {};
                /*test input*/
                $.each($("#"+id+"-row .my-editable"), function (i, item) {
                    let input = item.children[0];
                    json[input.getAttribute("name")] = input.value;
                });
                /*QA input*/
                let qa_list = [];
                let cnt = 0;
                $.each($("#"+id+"-question-row .obj-question"),function(){
                    let qa_json = {};
                    cnt++;
                    $.each($(this).find(".my-editable"),function(j,item){
                        let input = item.children[0];
                        qa_json[input.getAttribute("name")] = input.value;
                    });
                    qa_list.push(qa_json);
                });
                json["QA"] = qa_list;
                /*QB input*/
                let qb_list = [];
                $.each($("#"+id+"-question-row .sub-question"),function(){
                    let qb_json = {};
                    $.each($(this).find(".my-editable"),function(j,item){
                        let input = item.children[0];
                        qb_json[input.getAttribute("name")] = input.value;
                    });
                    qb_list.push(qb_json);
                });
                json["QB"] = qb_list;
                json["uid"] = uid;
                json["cid"] = cid;
                if(qa_list.length===0){
                    json["ttype"] = 1;
                    json["cnt"] = qb_list.length;
                }
                else {
                    json["ttype"] = 0;
                    json["cnt"] = qa_list.length;
                }
                console.log(json);
                $.ajax({
                    url:add_url+"?action=edit_user_list",
                    type:"POST",
                    data:json,
                    success:function(data){
                        alert("success");
                        $.each($("#"+id+"-question-row .my-editable, #"+id+"-row .my-editable"), function (i, item) {
                            let input = item.children[0];
                            item.innerHTML=(input.value);
                        });
                        $("#"+id+"-row [data-toggle='collapse']").attr("href","#t"+id+"-question-form");
                        $("#t"+id+"-question-form").parent().attr({"colspan":5});
                        $("#"+id+"-row .my-edt-btn").html("Edit").toggleClass("bg-orange");
                        $("#"+id+"-row .my-del-btn").show();
                        $("#"+id+"-question-list-add-btn").hide();
                        console.log(data);
                        console.log("submited");
                    },
                    error:function(){
                        alert("Connection error, item cannot be updated ,please try again later");
                    }
                });
            }
        });
        $("#quiz-table .my-del-btn").on("click",function () {
            let id = this.id.slice(0,-8);
            console.log(id);
            let json = {};
            $.each($("#"+id+"-row .my-editable"), function (i, item) {
                json[namelist[i]] = item.innerHTML.replace(/^\s+|\s+$/g,"");
            });
            console.log(json);
            $.ajax({
                url:del_url+"?action=delete_quiz_list&tid="+id,
                type:"GET",
                success:function(data){
                    alert("success");
                    $("#"+id+"-row").remove();
                    $("#"+id+"-question-row").remove();
                    console.log(data);
                    console.log("deleted");
                },
                error:function(){
                    alert("Connection error, please try again later");
                }
            });
        });
        $(".obj-question-list-add-btn").on("click",function () {
            let tid = this.id.slice(0,-22);
            console.log(tid);
            $("#"+tid+"-question-list-add-btn").before("" +
                "<hr class=\"m-0 mx-3\">\n" +
                "<div class=\"card-body py-3 question-container obj-question\">\n" +
                "    <span class=\"my-editable my-editable-obj-title\">\n" +
                "        <input type=\"text\" name=\"title\" class=\"text\">\n" +
                "    </span>\n" +
                "    <div class=\" mt-2 choice-container\">\n" +
                "        <div class=\"my-editable my-editable-obj-choice\">\n" +
                "            <input type=\"text\" name=\"choiceA\" class=\"text\">\n" +
                "        </div>\n" +
                "        <div class=\"my-editable my-editable-obj-choice\">\n" +
                "            <input type=\"text\" name=\"choiceB\" class=\"text\">\n" +
                "        </div>\n" +
                "        <div class=\"my-editable my-editable-obj-choice\">\n" +
                "            <input type=\"text\" name=\"choiceC\" class=\"text\">\n" +
                "        </div>\n" +
                "        <div class=\"my-editable my-editable-obj-choice\">\n" +
                "            <input type=\"text\" name=\"choiceD\" class=\"text\">\n" +
                "        </div>\n" +
                "        <div class=\"mt-2 my-editable my-editable-obj-choice my-editable-obj-std\">\n" +
                "           <input type=\"text\" name=\"std\" class=\"text\">" +
                "       </div>"+
                "    </div>" +
                "</div>"
            );
        });
        $(".sub-question-list-add-btn").on("click",function () {
            let tid = this.id.slice(0,-22);
            console.log(tid);
            $("#"+tid+"-question-list-add-btn").before("" +
                "<hr class=\"m-0 mx-3\">\n" +
                "<div class=\"card-body py-3 question-container sub-question\">\n" +
                "    <span class=\"my-editable my-editable-sub-title\">\n" +
                "        <input type=\"text\" name=\"title\" class=\"text\">\n" +
                "    </span>\n" +
                "</div>"
            );
        });
        $("#obj-test-add-btn").on("click",function () {
            $("#quiz-list-add-btn-row").before("" +
                "<tr id=\"new-row\">\n" +
                "    <th scope=\"row\" class=\"name\">\n" +
                "        <a href=\"#\" class=\"text-purple quiz-link text-sm my-editable\" data-toggle=\"collapse\" role=\"button\" aria-expanded=\"false\" aria-controls=\"collapseExample\">\n" +
                "            <input type=\"text\" name=\"tname\" class=\"text\">\n" +
                "        </a>\n" +
                "    </th>\n" +
                "    <td class=\"tid my-editable\">\n" +
                "        <input type=\"number\" name=\"tid\" class=\"text\">\n" +
                "    </td>\n" +
                "    <td class=\"type my-editable text-capitalize\">\n" +
                "        <input type=\"text\" name=\"type\" class=\"text\">\n" +
                "    </td>\n" +
                "    <td class=\"due my-editable\">\n" +
                "        <input type=\"text\" name=\"due\" class=\"text\">\n" +
                "    </td>\n" +
                "    <td class=\"edit-container\" style=\"width: 15rem\">\n" +
                "        <button id=\"new-edt-btn\" type=\"button\" class=\"btn btn-sm bg-blue px-3 text-white my-edt-btn bg-orange\">Save</button>\n" +
                "        <button id=\"new-del-btn\" type=\"button\" class=\"btn btn-sm bg-red px-3 text-white my-del-btn\" style=\"display: none;\">Delete</button>\n" +
                "    </td>\n" +
                "</tr>\n" +
                "<tr class=\"border-bottom-0 obj-question-row\" id=\"new-question-row\">\n" +
                "    <td colspan=\"4\" class=\"p-0 border-top-0\">\n" +
                "        <form class=\"collapse show\" action=\"\" id=\"new-question-form\" readonly=\"readonly\">\n" +
                "            <hr class=\"m-0 mx-3\">\n" +
                "            <div class=\"card-body py-3 question-container obj-question\">\n" +
                "                <span class=\"my-editable my-editable-obj-title\">\n" +
                "                    <input type=\"text\" name=\"title\" class=\"text\">\n" +
                "                </span>\n" +
                "                <div class=\" mt-2 choice-container\">\n" +
                "                    <div class=\"my-editable my-editable-obj-choice\">\n" +
                "                        <input type=\"text\" name=\"choiceA\" class=\"text\">\n" +
                "                    </div>\n" +
                "                    <div class=\"my-editable my-editable-obj-choice\">\n" +
                "                        <input type=\"text\" name=\"choiceB\" class=\"text\">\n" +
                "                    </div>\n" +
                "                    <div class=\"my-editable my-editable-obj-choice\">\n" +
                "                        <input type=\"text\" name=\"choiceC\" class=\"text\">\n" +
                "                    </div>\n" +
                "                    <div class=\"my-editable my-editable-obj-choice\">\n" +
                "                        <input type=\"text\" name=\"choiceD\" class=\"text\">\n" +
                "                    </div>" +
                "                    <div class=\"mt-2 my-editable my-editable-obj-choice my-editable-obj-std\">\n" +
                "                       <input type=\"text\" name=\"std\" class=\"text\">" +
                "                    </div>" +
                "                </div>\n" +
                "            </div>\n" +
                "            </div><button id=\"new-question-list-add-btn\" type=\"button\" class=\"btn btn-sm mx-4 mb-3 text-white bg-gray question-list-add-btn obj-question-list-add-btn\" style=\"\">Add New Question</button>\n" +
                "        </form>\n" +
                "    </td>\n" +
                "</tr>"
            );

            /*add the listener to new btns*/
            let newRow = $("#new-row");
            let newQuestionRow = $("#new-question-row");
            let newSaveBtn = $("#new-edt-btn");
            let id = "new";
            $("#new-question-list-add-btn").on("click",function () {
                let tid = this.id.slice(0,-22);
                console.log(tid);
                $("#"+tid+"-question-list-add-btn").before("" +
                    "<hr class=\"m-0 mx-3\">\n" +
                    "<div class=\"card-body py-3 question-container obj-question\">\n" +
                    "    <span class=\"my-editable my-editable-obj-title\">\n" +
                    "        <input type=\"text\" name=\"title\" class=\"text\">\n" +
                    "    </span>\n" +
                    "    <div class=\" mt-2 choice-container\">\n" +
                    "        <div class=\"my-editable my-editable-obj-choice\">\n" +
                    "            <input type=\"text\" name=\"choiceA\" class=\"text\">\n" +
                    "        </div>\n" +
                    "        <div class=\"my-editable my-editable-obj-choice\">\n" +
                    "            <input type=\"text\" name=\"choiceB\" class=\"text\">\n" +
                    "        </div>\n" +
                    "        <div class=\"my-editable my-editable-obj-choice\">\n" +
                    "            <input type=\"text\" name=\"choiceC\" class=\"text\">\n" +
                    "        </div>\n" +
                    "        <div class=\"my-editable my-editable-obj-choice\">\n" +
                    "            <input type=\"text\" name=\"choiceD\" class=\"text\">\n" +
                    "        </div>\n" +
                    "        <div class=\"mt-2 my-editable my-editable-obj-choice my-editable-obj-std\">\n" +
                    "           <input type=\"text\" name=\"std\" class=\"text\">" +
                    "       </div>"+
                    "    </div>" +
                    "</div>"
                );
            });
            $("#new-del-btn").on("click",function () {
                let id = this.id.slice(0,-8);
                console.log(id);
                let json = {};
                $.each($("#"+id+"-row .my-editable"), function (i, item) {
                    json[namelist[i]] = item.innerHTML.replace(/^\s+|\s+$/g,"");
                });
                console.log(json);
                $.ajax({
                    url:del_url+"?action=delete_quiz_list&tid="+id,
                    type:"GET",
                    success:function(data){
                        alert("success");
                        $("#"+id+"-row").remove();
                        $("#"+id+"-question-row").remove();
                        console.log(data);
                        console.log("deleted");
                    },
                    error:function(){
                        alert("Connection error, please try again later");
                    }
                });
            });
            $("#new-edt-btn").on("click",function () {
                id = newRow.find("[name='tid']")[0].value;
                newRow.attr("id",""+id+"-row");
                newQuestionRow.attr("id",""+id+"-question-row").find("#new-question-form").attr("id","t"+id+"-question-form")
                    .find("#new-question-list-add-btn").attr("id",""+id+"-question-list-add-btn");
                $(this).attr("id",""+id+"-edt-btn");
                $(this).next().attr("id",""+id+"-del-btn");
                console.log(id);

                $("#"+id+"-edt-btn").off("click");
                $("#"+id+"-del-btn").on("click",function () {
                    let id = this.id.slice(0,-8);
                    console.log(id);
                    let json = {};
                    $.each($("#"+id+"-row .my-editable"), function (i, item) {
                        json[namelist[i]] = item.innerHTML.replace(/^\s+|\s+$/g,"");
                    });
                    console.log(json);
                    $.ajax({
                        url:del_url+"?action=delete_quiz_list&tid="+id,
                        type:"GET",
                        success:function(data){
                            alert("success");
                            $("#"+id+"-row").remove();
                            $("#"+id+"-question-row").remove();
                            console.log(data);
                            console.log("deleted");
                        },
                        error:function(){
                            alert("Connection error, please try again later");
                        }
                    });
                });
                $("#"+id+"-question-list-add-btn").on("click",function () {
                    let tid = this.id.slice(0,-22);
                    console.log(tid);
                    $("#"+tid+"-question-list-add-btn").before("" +
                        "<hr class=\"m-0 mx-3\">\n" +
                        "<div class=\"card-body py-3 question-container obj-question\">\n" +
                        "    <span class=\"my-editable my-editable-obj-title\">\n" +
                        "        <input type=\"text\" name=\"title\" class=\"text\">\n" +
                        "    </span>\n" +
                        "    <div class=\" mt-2 choice-container\">\n" +
                        "        <div class=\"my-editable my-editable-obj-choice\">\n" +
                        "            <input type=\"text\" name=\"choiceA\" class=\"text\">\n" +
                        "        </div>\n" +
                        "        <div class=\"my-editable my-editable-obj-choice\">\n" +
                        "            <input type=\"text\" name=\"choiceB\" class=\"text\">\n" +
                        "        </div>\n" +
                        "        <div class=\"my-editable my-editable-obj-choice\">\n" +
                        "            <input type=\"text\" name=\"choiceC\" class=\"text\">\n" +
                        "        </div>\n" +
                        "        <div class=\"my-editable my-editable-obj-choice\">\n" +
                        "            <input type=\"text\" name=\"choiceD\" class=\"text\">\n" +
                        "        </div>\n" +
                        "        <div class=\"mt-2 my-editable my-editable-obj-choice my-editable-obj-std\">\n" +
                        "           <input type=\"text\" name=\"std\" class=\"text\">" +
                        "       </div>"+
                        "    </div>" +
                        "</div>"
                    );
                });
                {
                    let id = this.id.slice(0,-8);
                    console.log(id);
                    /*点击了edit*/
                    if($(this).html()==="Edit"){
                        $("#"+id+"-row .my-editable").each(function (i) {
                            var value = $(this).html();
                            $(this).html("" +
                                "<input type='text' name=\""+ namelist[i] +"\" class='text' value=\""+ value +"\">"
                            );
                        });
                        /*QA naming*/
                        var qa_namelist = ["title","choiceA","choiceB","choiceC","choiceD","std"];
                        $("#"+id+"-question-row.obj-question-row .my-editable").each(function (i) {
                            var value = $(this).html();
                            $(this).html("" +
                                "<input type='text' name=\""+ qa_namelist[i%6] +"\" class='text' value=\""+ value +"\">"
                            );
                        });
                        /*QB naming*/
                        var qb_namelist = ["title"];
                        $("#"+id+"-question-row.sub-question-row .my-editable").each(function (i) {
                            var value = $(this).html();
                            $(this).html("" +
                                "<input type='text' name=\""+ qb_namelist[i%1] +"\" class='text' value=\""+ value +"\">"
                            );
                        });
                        /*button changing*/
                        $("#"+id+"-row input[name='tid']").attr("readonly",true);
                        $("#"+id+"-row input[name='type']").attr("readonly",true);
                        $("#"+id+"-row [data-toggle='collapse']").attr("href","#");
                        $("#t"+id+"-question-form").attr({"readonly":true}).toggleClass("show",true).parent().attr({"colspan":5})
                        $("#"+id+"-row .my-del-btn").hide();
                        $("#"+id+"-question-list-add-btn").show();
                        $(this).html("Save").toggleClass("bg-orange");
                    }
                    /*点击了save*/
                    else {
                        let json = {};
                        /*test input*/
                        $.each($("#"+id+"-row .my-editable"), function (i, item) {
                            let input = item.children[0];
                            json[input.getAttribute("name")] = input.value;
                        });
                        /*QA input*/
                        let qa_list = [];
                        let cnt = 0;
                        $.each($("#"+id+"-question-row .obj-question"),function(){
                            let qa_json = {};
                            cnt++;
                            $.each($(this).find(".my-editable"),function(j,item){
                                let input = item.children[0];
                                qa_json[input.getAttribute("name")] = input.value;
                            });
                            qa_list.push(qa_json);
                        });
                        json["QA"] = qa_list;
                        /*QB input*/
                        let qb_list = [];
                        $.each($("#"+id+"-question-row .sub-question"),function(){
                            let qb_json = {};
                            $.each($(this).find(".my-editable"),function(j,item){
                                let input = item.children[0];
                                qb_json[input.getAttribute("name")] = input.value;
                            });
                            qb_list.push(qb_json);
                        });
                        json["QB"] = qb_list;
                        json["uid"] = uid;
                        json["cid"] = cid;
                        if(qa_list.length===0){
                            json["ttype"] = 1;
                            json["cnt"] = qb_list.length;
                        }
                        else {
                            json["ttype"] = 0;
                            json["cnt"] = qa_list.length;
                        }
                        console.log(json);
                        $.ajax({
                            url:add_url+"?action=edit_user_list",
                            type:"POST",
                            data:json,
                            success:function(data){
                                alert("success");
                                $.each($("#"+id+"-question-row .my-editable, #"+id+"-row .my-editable"), function (i, item) {
                                    let input = item.children[0];
                                    item.innerHTML=(input.value);
                                });
                                $("#"+id+"-row [data-toggle='collapse']").attr("href","#t"+id+"-question-form");
                                $("#t"+id+"-question-form").parent().attr({"colspan":5});
                                $("#"+id+"-row .my-edt-btn").html("Edit").toggleClass("bg-orange");
                                $("#"+id+"-row .my-del-btn").show();
                                $("#"+id+"-question-list-add-btn").hide();
                                console.log(data);
                                console.log("submited");
                            },
                            error:function(){
                                alert("Connection error, item cannot be updated ,please try again later");
                            }
                        });
                    }
                }
                $("#"+id+"-edt-btn").on("click",function () {
                    let id = this.id.slice(0,-8);
                    console.log(id);
                    /*点击了edit*/
                    if($(this).html()==="Edit"){
                        $("#"+id+"-row .my-editable").each(function (i) {
                            var value = $(this).html();
                            $(this).html("" +
                                "<input type='text' name=\""+ namelist[i] +"\" class='text' value=\""+ value +"\">"
                            );
                        });
                        /*QA naming*/
                        var qa_namelist = ["title","choiceA","choiceB","choiceC","choiceD","std"];
                        $("#"+id+"-question-row.obj-question-row .my-editable").each(function (i) {
                            var value = $(this).html();
                            $(this).html("" +
                                "<input type='text' name=\""+ qa_namelist[i%6] +"\" class='text' value=\""+ value +"\">"
                            );
                        });
                        /*QB naming*/
                        var qb_namelist = ["title"];
                        $("#"+id+"-question-row.sub-question-row .my-editable").each(function (i) {
                            var value = $(this).html();
                            $(this).html("" +
                                "<input type='text' name=\""+ qb_namelist[i%1] +"\" class='text' value=\""+ value +"\">"
                            );
                        });
                        /*button changing*/
                        $("#"+id+"-row input[name='tid']").attr("readonly",true);
                        $("#"+id+"-row input[name='type']").attr("readonly",true);
                        $("#"+id+"-row [data-toggle='collapse']").attr("href","#");
                        $("#t"+id+"-question-form").attr({"readonly":true}).toggleClass("show",true).parent().attr({"colspan":5})
                        $("#"+id+"-row .my-del-btn").hide();
                        $("#"+id+"-question-list-add-btn").show();
                        $(this).html("Save").toggleClass("bg-orange");
                    }
                    /*点击了save*/
                    else {
                        let json = {};
                        /*test input*/
                        $.each($("#"+id+"-row .my-editable"), function (i, item) {
                            let input = item.children[0];
                            json[input.getAttribute("name")] = input.value;
                        });
                        /*QA input*/
                        let qa_list = [];
                        let cnt = 0;
                        $.each($("#"+id+"-question-row .obj-question"),function(){
                            let qa_json = {};
                            cnt++;
                            $.each($(this).find(".my-editable"),function(j,item){
                                let input = item.children[0];
                                qa_json[input.getAttribute("name")] = input.value;
                            });
                            qa_list.push(qa_json);
                        });
                        json["QA"] = qa_list;
                        /*QB input*/
                        let qb_list = [];
                        $.each($("#"+id+"-question-row .sub-question"),function(){
                            let qb_json = {};
                            $.each($(this).find(".my-editable"),function(j,item){
                                let input = item.children[0];
                                qb_json[input.getAttribute("name")] = input.value;
                            });
                            qb_list.push(qb_json);
                        });
                        json["QB"] = qb_list;
                        json["uid"] = uid;
                        json["cid"] = cid;
                        if(qa_list.length===0){
                            json["ttype"] = 1;
                            json["cnt"] = qb_list.length;
                        }
                        else {
                            json["ttype"] = 0;
                            json["cnt"] = qa_list.length;
                        }
                        console.log(json);
                        $.ajax({
                            url:add_url+"?action=edit_user_list",
                            type:"POST",
                            data:json,
                            success:function(data){
                                alert("success");
                                $.each($("#"+id+"-question-row .my-editable, #"+id+"-row .my-editable"), function (i, item) {
                                    let input = item.children[0];
                                    item.innerHTML=(input.value);
                                });
                                $("#"+id+"-row [data-toggle='collapse']").attr("href","#t"+id+"-question-form");
                                $("#t"+id+"-question-form").parent().attr({"colspan":5});
                                $("#"+id+"-row .my-edt-btn").html("Edit").toggleClass("bg-orange");
                                $("#"+id+"-row .my-del-btn").show();
                                $("#"+id+"-question-list-add-btn").hide();
                                console.log(data);
                                console.log("submited");
                            },
                            error:function(){
                                alert("Connection error, item cannot be updated ,please try again later");
                            }
                        });
                    }
                });
                $("#"+id+"-del-btn").on("click",function () {
                    let id = this.id.slice(0,-8);
                    console.log(id);
                    let json = {};
                    $.each($("#"+id+"-row .my-editable"), function (i, item) {
                        json[namelist[i]] = item.innerHTML.replace(/^\s+|\s+$/g,"");
                    });
                    console.log(json);
                    $.ajax({
                        url:del_url+"?action=delete_quiz_list&tid="+id,
                        type:"GET",
                        success:function(data){
                            alert("success");
                            $("#"+id+"-row").remove();
                            $("#"+id+"-question-row").remove();
                            console.log(data);
                            console.log("deleted");
                        },
                        error:function(){
                            alert("Connection error, please try again later");
                        }
                    });
                });
                $("#"+id+"-question-list-add-btn").on("click",function () {
                    let tid = this.id.slice(0,-22);
                    console.log(tid);
                    $("#"+tid+"-question-list-add-btn").before("" +
                        "<hr class=\"m-0 mx-3\">\n" +
                        "<div class=\"card-body py-3 question-container obj-question\">\n" +
                        "    <span class=\"my-editable my-editable-obj-title\">\n" +
                        "        <input type=\"text\" name=\"title\" class=\"text\">\n" +
                        "    </span>\n" +
                        "    <div class=\" mt-2 choice-container\">\n" +
                        "        <div class=\"my-editable my-editable-obj-choice\">\n" +
                        "            <input type=\"text\" name=\"choiceA\" class=\"text\">\n" +
                        "        </div>\n" +
                        "        <div class=\"my-editable my-editable-obj-choice\">\n" +
                        "            <input type=\"text\" name=\"choiceB\" class=\"text\">\n" +
                        "        </div>\n" +
                        "        <div class=\"my-editable my-editable-obj-choice\">\n" +
                        "            <input type=\"text\" name=\"choiceC\" class=\"text\">\n" +
                        "        </div>\n" +
                        "        <div class=\"my-editable my-editable-obj-choice\">\n" +
                        "            <input type=\"text\" name=\"choiceD\" class=\"text\">\n" +
                        "        </div>\n" +
                        "        <div class=\"mt-2 my-editable my-editable-obj-choice my-editable-obj-std\">\n" +
                        "           <input type=\"text\" name=\"std\" class=\"text\">" +
                        "       </div>"+
                        "    </div>" +
                        "</div>"
                    );
                });
                // $("#"+id+"-edt-btn").on("click",function () {
                //     let id = this.id.slice(0,-8);
                //     // let id = this.parentNode.id;
                //     console.log(id);
                //     // console.log($(this).html());
                //     if($(this).html()==="Edit"){
                //         $("#"+id+"-row .my-editable").each(function (i) {
                //             var value = $(this).html();
                //             $(this).html("" +
                //                 "<input type='text' name=\""+ namelist[i] +"\" class='text' value=\""+ value +"\">"
                //             );
                //         });
                //         /*QA naming*/
                //         var qa_namelist = ["title","choiceA","choiceB","choiceC","choiceD","std"];
                //         $("#"+id+"-question-row.obj-question-row .my-editable").each(function (i) {
                //             var value = $(this).html();
                //             // var name = "";
                //             // // !!!uhzndskflrewqey98734y1iuhad"siufhaln;kdshcdhfcmm
                //             // name = $(this).attr("id");
                //             // console.log(value);
                //             $(this).html("" +
                //                 "<input type='text' name=\""+ qa_namelist[i%6] +"\" class='text' value=\""+ value +"\">"
                //             );
                //         });
                //         /*QB naming*/
                //         var qb_namelist = ["title"];
                //         $("#"+id+"-question-row.sub-question-row .my-editable").each(function (i) {
                //             var value = $(this).html();
                //             // var name = "";
                //             // // !!!uhzndskflrewqey98734y1iuhad"siufhaln;kdshcdhfcmm
                //             // name = $(this).attr("id");
                //             // console.log(value);
                //             $(this).html("" +
                //                 "<input type='text' name=\""+ qa_namelist[i%1] +"\" class='text' value=\""+ value +"\">"
                //             );
                //         });
                //
                //         /*button changing*/
                //         $("#"+id+"-row input[name='tid']").attr("readonly",true);
                //         $("#"+id+"-row input[name='type']").attr("readonly",true);
                //         $("#"+id+"-row [data-toggle='collapse']").attr("href","#");
                //         $("#"+id+"-question-form").attr({"readonly":true}).toggleClass("show",true).parent().attr({"colspan":4})
                //         /*.after("")*/;
                //         $("#"+id+"-row .my-del-btn").hide();
                //         $("#"+id+"-question-list-add-btn").show();
                //         $(this).html("Save").toggleClass("bg-orange");
                //     }
                //     else {
                //         let json = {};
                //         /*test input*/
                //         $.each($("#"+id+"-row .my-editable"), function (i, item) {
                //             let input = item.children[0];
                //             json[input.getAttribute("name")] = input.value;
                //             // console.log(input.value);
                //             // item.innerHTML=(input.value);
                //         });
                //         /*QA input*/
                //         let qa_list = [];
                //         $.each($("#"+id+"-question-row .obj-question"),function(){
                //             let qa_json = {};
                //             $.each($(this).find(".my-editable"),function(j,item){
                //                 let input = item.children[0];
                //                 qa_json[input.getAttribute("name")] = input.value;
                //             });
                //             qa_list.push(qa_json);
                //         });
                //         json["QA"] = qa_list;
                //         /*QB input*/
                //         let qb_list = [];
                //         let cnt = 0;
                //         $.each($("#"+id+"-question-row .sub-question"),function(){
                //             let qb_json = {};
                //             cnt++;
                //             $.each($(this).find(".my-editable"),function(j,item){
                //                 let input = item.children[0];
                //                 qb_json[input.getAttribute("name")] = input.value;
                //             });
                //             qb_list.push(qb_json);
                //         });
                //         json["QB"] = qb_list;
                //         json["cnt"] = qa_list.length;
                //         json["uid"] = uid;
                //         json["cid"] = cid;
                //         if(qa_list.length===0){
                //             json["ttype"] = 1;
                //         }
                //         else {
                //             json["ttype"] = 0;
                //         }
                //
                //         console.log(json);
                //
                //         let url = "http://192.168.2.114:8080/phptest/add_quiz.php"
                //
                //         $.ajax({
                //             url:url+"?action=edit_user_list",
                //             type:"POST",
                //             // data:JSON.stringify(json),
                //             data:json,
                //             // contentType:"application/json",  //缺失会出现URL编码，无法转成json对象
                //             success:function(data){
                //                 alert("success");
                //                 $.each($("#"+id+"-question-row .my-editable, #"+id+"-row .my-editable"), function (i, item) {
                //                     let input = item.children[0];
                //                     item.innerHTML=(input.value);
                //                 });
                //                 $("#"+id+"-row [data-toggle='collapse']").attr("href","#"+id+"-question-form");
                //                 $("#"+id+"-question-form").parent().attr({"colspan":5});
                //                 $("#"+id+"-row .my-edt-btn").html("Edit").toggleClass("bg-orange");
                //                 $("#"+id+"-row .my-del-btn").show();
                //                 $("#"+id+"-question-list-add-btn").hide();
                //                 console.log(data);
                //                 console.log("submited");
                //             },
                //             error:function(){
                //                 alert("Connection error, item cannot be updated ,please try again later");
                //             }
                //         });
                //         console.log(json);
                //         // console.log(json_list);
                //         // $(this).html("Edit").toggleClass("bg-orange");
                //     }
                // });
                // $("#"+id+"-del-btn").on("click",function () {
                //     let id = this.id.slice(0,-8);
                //     console.log(id);
                //     let json = {};
                //     $.each($("#"+id+"-row .my-editable"), function (i, item) {
                //         json[namelist[i]] = item.innerHTML.replace(/^\s+|\s+$/g,"");
                //     });
                //     $.ajax({
                //         url:url+"?action=delete_quiz_list&tid="+id,
                //         type:"GET",
                //         success:function(data){
                //             alert("success");
                //             $("#"+id+"-row").remove();
                //             $("#"+id+"-question-row").remove();
                //             // console.log(data);
                //             console.log("deleted");
                //         },
                //         error:function(){
                //             alert("Connection error, please try again later");
                //         }
                //     });
                //     console.log(json);
                // });
                // $("#"+id+"-question-list-add-btn").on("click",function () {
                //     let tid = this.id.slice(0,-22);
                //     console.log(tid);
                //     $("#"+tid+"-question-list-add-btn").before("" +
                //         "<hr class=\"m-0 mx-3\">\n" +
                //         "<div class=\"card-body py-3 question-container obj-question\">\n" +
                //         "    <span class=\"my-editable my-editable-obj-title\">\n" +
                //         "        <input type=\"text\" name=\"title\" class=\"text\">\n" +
                //         "    </span>\n" +
                //         "    <div class=\" mt-2 choice-container\">\n" +
                //         "        <div class=\"my-editable my-editable-obj-choice\">\n" +
                //         "            <input type=\"text\" name=\"choiceA\" class=\"text\">\n" +
                //         "        </div>\n" +
                //         "        <div class=\"my-editable my-editable-obj-choice\">\n" +
                //         "            <input type=\"text\" name=\"choiceB\" class=\"text\">\n" +
                //         "        </div>\n" +
                //         "        <div class=\"my-editable my-editable-obj-choice\">\n" +
                //         "            <input type=\"text\" name=\"choiceC\" class=\"text\">\n" +
                //         "        </div>\n" +
                //         "        <div class=\"my-editable my-editable-obj-choice\">\n" +
                //         "            <input type=\"text\" name=\"choiceD\" class=\"text\">\n" +
                //         "        </div>\n" +
                //         "        <div class=\"mt-2 my-editable my-editable-obj-choice my-editable-obj-std\">\n" +
                //         "            <input type=\"text\" name=\"std\" class=\"text\">" +
                //         "        </div>" +
                //         "    </div>\n" +
                //         "</div>"
                //     );
                //     let newQuestion = $("#"+tid+"-question-list-add-btn").prev();
                // });
            });

        });
        $("#sub-test-add-btn").on("click",function () {
            $("#quiz-list-add-btn-row").before("" +
                "<tr id=\"new-row\">\n" +
                "    <th scope=\"row\" class=\"name\">\n" +
                "        <a href=\"#\" class=\"text-purple quiz-link text-sm my-editable\" data-toggle=\"collapse\" role=\"button\" aria-expanded=\"false\" aria-controls=\"collapseExample\">\n" +
                "            <input type=\"text\" name=\"tname\" class=\"text\">\n" +
                "        </a>\n" +
                "    </th>\n" +
                "    <td class=\"tid my-editable\">\n" +
                "        <input type=\"text\" name=\"tid\" class=\"text\">\n" +
                "    </td>\n" +
                "    <td class=\"type my-editable text-capitalize\">\n" +
                "        <input type=\"text\" name=\"type\" class=\"text\">\n" +
                "    </td>\n" +
                "    <td class=\"due my-editable\">\n" +
                "        <input type=\"text\" name=\"due\" class=\"text\">\n" +
                "    </td>\n" +
                "    <td class=\"edit-container\" style=\"width: 15rem\">\n" +
                "        <button id=\"new-edt-btn\" type=\"button\" class=\"btn btn-sm bg-blue px-3 text-white my-edt-btn bg-orange\">Save</button>\n" +
                "        <button id=\"new-del-btn\" type=\"button\" class=\"btn btn-sm bg-red px-3 text-white my-del-btn\" style=\"display: none;\">Delete</button>\n" +
                "    </td>\n" +
                "</tr>\n" +
                "<tr class=\"border-bottom-0 sub-question-row\" id=\"new-question-row\">\n" +
                "    <td colspan=\"4\" class=\"p-0 border-top-0\">\n" +
                "        <form class=\"collapse show\" action=\"\" id=\"new-question-form\" readonly=\"readonly\">\n" +
                "            <hr class=\"m-0 mx-3\">\n" +
                "            <div class=\"card-body py-3 question-container sub-question\">\n" +
                "                <span class=\"my-editable my-editable-sub-title\">\n" +
                "                    <input type=\"text\" name=\"title\" class=\"text\">\n" +
                "                </span>\n" +
                "            </div><button id=\"new-question-list-add-btn\" type=\"button\" class=\"btn btn-sm mx-4 mb-3 text-white bg-gray question-list-add-btn sub-question-list-add-btn\" style=\"\">Add New Question</button>\n" +
                "        </form>\n" +
                "    </td>\n" +
                "</tr>"
            );

            /*add the listener to sub btns*/
            let newRow = $("#new-row");
            let newQuestionRow = $("#new-question-row");
            let newSaveBtn = $("#new-edt-btn");
            let id = "new";
            $("#"+id+"-question-list-add-btn").on("click",function () {
                let tid = this.id.slice(0,-22);
                console.log(tid);
                $("#"+tid+"-question-list-add-btn").before("" +
                    "<hr class=\"m-0 mx-3\">\n" +
                    "<div class=\"card-body py-3 question-container sub-question\">\n" +
                    "    <span class=\"my-editable my-editable-sub-title\">\n" +
                    "        <input type=\"text\" name=\"title\" class=\"text\">\n" +
                    "    </span>\n" +
                    "</div>"
                );
            });
            $("#"+id+"-del-btn").on("click",function () {
                let id = this.id.slice(0,-8);
                console.log(id);
                let json = {};
                $.each($("#"+id+"-row .my-editable"), function (i, item) {
                    json[namelist[i]] = item.innerHTML.replace(/^\s+|\s+$/g,"");
                });
                console.log(json);
                $.ajax({
                    url:del_url+"?action=delete_quiz_list&tid="+id,
                    type:"GET",
                    success:function(data){
                        alert("success");
                        $("#"+id+"-row").remove();
                        $("#"+id+"-question-row").remove();
                        console.log(data);
                        console.log("deleted");
                    },
                    error:function(){
                        alert("Connection error, please try again later");
                    }
                });
            });
            $("#"+id+"-edt-btn").on("click",function () {
                id = newRow.find("[name='tid']")[0].value;
                console.log(id);
                newRow.attr("id",""+id+"-row");
                newQuestionRow.attr("id",""+id+"-question-row").find("#new-question-form").attr("id",""+id+"-question-form")
                    .find("#new-question-list-add-btn").attr("id",""+id+"-question-list-add-btn");
                $(this).attr("id",""+id+"-edt-btn");
                $(this).next().attr("id",""+id+"-del-btn");
                console.log(id);

                $("#"+id+"-edt-btn").off("click");
                {
                    let id = this.id.slice(0,-8);
                    console.log(id);
                    /*点击了edit*/
                    if($(this).html()==="Edit"){
                        $("#"+id+"-row .my-editable").each(function (i) {
                            var value = $(this).html();
                            $(this).html("" +
                                "<input type='text' name=\""+ namelist[i] +"\" class='text' value=\""+ value +"\">"
                            );
                        });
                        /*QA naming*/
                        var qa_namelist = ["title","choiceA","choiceB","choiceC","choiceD","std"];
                        $("#"+id+"-question-row.obj-question-row .my-editable").each(function (i) {
                            var value = $(this).html();
                            $(this).html("" +
                                "<input type='text' name=\""+ qa_namelist[i%6] +"\" class='text' value=\""+ value +"\">"
                            );
                        });
                        /*QB naming*/
                        var qb_namelist = ["title"];
                        $("#"+id+"-question-row.sub-question-row .my-editable").each(function (i) {
                            var value = $(this).html();
                            $(this).html("" +
                                "<input type='text' name=\""+ qb_namelist[i%1] +"\" class='text' value=\""+ value +"\">"
                            );
                        });
                        /*button changing*/
                        $("#"+id+"-row input[name='tid']").attr("readonly",true);
                        $("#"+id+"-row input[name='type']").attr("readonly",true);
                        $("#"+id+"-row [data-toggle='collapse']").attr("href","#");
                        $("#"+id+"-question-form").attr({"readonly":true}).toggleClass("show",true).parent().attr({"colspan":4})
                        $("#"+id+"-row .my-del-btn").hide();
                        $("#"+id+"-question-list-add-btn").show();
                        $(this).html("Save").toggleClass("bg-orange");
                    }
                    /*点击了save*/
                    else {
                        let json = {};
                        /*test input*/
                        $.each($("#"+id+"-row .my-editable"), function (i, item) {
                            let input = item.children[0];
                            json[input.getAttribute("name")] = input.value;
                        });
                        /*QA input*/
                        let qa_list = [];
                        let cnt = 0;
                        $.each($("#"+id+"-question-row .obj-question"),function(){
                            let qa_json = {};
                            cnt++;
                            $.each($(this).find(".my-editable"),function(j,item){
                                let input = item.children[0];
                                qa_json[input.getAttribute("name")] = input.value;
                            });
                            qa_list.push(qa_json);
                        });
                        json["QA"] = qa_list;
                        /*QB input*/
                        let qb_list = [];
                        $.each($("#"+id+"-question-row .sub-question"),function(){
                            let qb_json = {};
                            $.each($(this).find(".my-editable"),function(j,item){
                                let input = item.children[0];
                                qb_json[input.getAttribute("name")] = input.value;
                            });
                            qb_list.push(qb_json);
                        });
                        json["QB"] = qb_list;
                        json["uid"] = uid;
                        json["cid"] = cid;
                        if(qa_list.length===0){
                            json["ttype"] = 1;
                            json["cnt"] = qb_list.length;
                        }
                        else {
                            json["ttype"] = 0;
                            json["cnt"] = qa_list.length;
                        }
                        console.log(json);
                        $.ajax({
                            url:add_url+"?action=edit_user_list",
                            type:"POST",
                            data:json,
                            success:function(data){
                                alert("success");
                                $.each($("#"+id+"-question-row .my-editable, #"+id+"-row .my-editable"), function (i, item) {
                                    let input = item.children[0];
                                    item.innerHTML=(input.value);
                                });
                                $("#"+id+"-row [data-toggle='collapse']").attr("href","#"+id+"-question-form");
                                $("#"+id+"-question-form").parent().attr({"colspan":5});
                                $("#"+id+"-row .my-edt-btn").html("Edit").toggleClass("bg-orange");
                                $("#"+id+"-row .my-del-btn").show();
                                $("#"+id+"-question-list-add-btn").hide();
                                console.log(data);
                                console.log("submited");
                            },
                            error:function(){
                                alert("Connection error, item cannot be updated ,please try again later");
                            }
                        });
                    }
                }
                $("#"+id+"-edt-btn").on("click",function () {
                    let id = this.id.slice(0,-8);
                    console.log(id);
                    /*点击了edit*/
                    if($(this).html()==="Edit"){
                        $("#"+id+"-row .my-editable").each(function (i) {
                            var value = $(this).html();
                            $(this).html("" +
                                "<input type='text' name=\""+ namelist[i] +"\" class='text' value=\""+ value +"\">"
                            );
                        });
                        /*QA naming*/
                        var qa_namelist = ["title","choiceA","choiceB","choiceC","choiceD","std"];
                        $("#"+id+"-question-row.obj-question-row .my-editable").each(function (i) {
                            var value = $(this).html();
                            $(this).html("" +
                                "<input type='text' name=\""+ qa_namelist[i%6] +"\" class='text' value=\""+ value +"\">"
                            );
                        });
                        /*QB naming*/
                        var qb_namelist = ["title"];
                        $("#"+id+"-question-row.sub-question-row .my-editable").each(function (i) {
                            var value = $(this).html();
                            $(this).html("" +
                                "<input type='text' name=\""+ qb_namelist[i%1] +"\" class='text' value=\""+ value +"\">"
                            );
                        });
                        /*button changing*/
                        $("#"+id+"-row input[name='tid']").attr("readonly",true);
                        $("#"+id+"-row input[name='type']").attr("readonly",true);
                        $("#"+id+"-row [data-toggle='collapse']").attr("href","#");
                        $("#"+id+"-question-form").attr({"readonly":true}).toggleClass("show",true).parent().attr({"colspan":4})
                        $("#"+id+"-row .my-del-btn").hide();
                        $("#"+id+"-question-list-add-btn").show();
                        $(this).html("Save").toggleClass("bg-orange");
                    }
                    /*点击了save*/
                    else {
                        let json = {};
                        /*test input*/
                        $.each($("#"+id+"-row .my-editable"), function (i, item) {
                            let input = item.children[0];
                            json[input.getAttribute("name")] = input.value;
                        });
                        /*QA input*/
                        let qa_list = [];
                        let cnt = 0;
                        $.each($("#"+id+"-question-row .obj-question"),function(){
                            let qa_json = {};
                            cnt++;
                            $.each($(this).find(".my-editable"),function(j,item){
                                let input = item.children[0];
                                qa_json[input.getAttribute("name")] = input.value;
                            });
                            qa_list.push(qa_json);
                        });
                        json["QA"] = qa_list;
                        /*QB input*/
                        let qb_list = [];
                        $.each($("#"+id+"-question-row .sub-question"),function(){
                            let qb_json = {};
                            $.each($(this).find(".my-editable"),function(j,item){
                                let input = item.children[0];
                                qb_json[input.getAttribute("name")] = input.value;
                            });
                            qb_list.push(qb_json);
                        });
                        json["QB"] = qb_list;
                        json["uid"] = uid;
                        json["cid"] = cid;
                        if(qa_list.length===0){
                            json["ttype"] = 1;
                            json["cnt"] = qb_list.length;
                        }
                        else {
                            json["ttype"] = 0;
                            json["cnt"] = qa_list.length;
                        }
                        console.log(json);
                        $.ajax({
                            url:add_url+"?action=edit_user_list",
                            type:"POST",
                            data:json,
                            success:function(data){
                                alert("success");
                                $.each($("#"+id+"-question-row .my-editable, #"+id+"-row .my-editable"), function (i, item) {
                                    let input = item.children[0];
                                    item.innerHTML=(input.value);
                                });
                                $("#"+id+"-row [data-toggle='collapse']").attr("href","#"+id+"-question-form");
                                $("#"+id+"-question-form").parent().attr({"colspan":5});
                                $("#"+id+"-row .my-edt-btn").html("Edit").toggleClass("bg-orange");
                                $("#"+id+"-row .my-del-btn").show();
                                $("#"+id+"-question-list-add-btn").hide();
                                console.log(data);
                                console.log("submited");
                            },
                            error:function(){
                                alert("Connection error, item cannot be updated ,please try again later");
                            }
                        });
                    }
                });
                $("#"+id+"-del-btn").on("click",function () {
                    let id = this.id.slice(0,-8);
                    console.log(id);
                    let json = {};
                    $.each($("#"+id+"-row .my-editable"), function (i, item) {
                        json[namelist[i]] = item.innerHTML.replace(/^\s+|\s+$/g,"");
                    });
                    console.log(json);
                    $.ajax({
                        url:del_url+"?action=delete_quiz_list&tid="+id,
                        type:"GET",
                        success:function(data){
                            alert("success");
                            $("#"+id+"-row").remove();
                            $("#"+id+"-question-row").remove();
                            console.log(data);
                            console.log("deleted");
                        },
                        error:function(){
                            alert("Connection error, please try again later");
                        }
                    });
                });
                $("#"+id+"-question-list-add-btn").on("click",function () {
                    let tid = this.id.slice(0,-22);
                    console.log(tid);
                    $("#"+tid+"-question-list-add-btn").before("" +
                        "<hr class=\"m-0 mx-3\">\n" +
                        "<div class=\"card-body py-3 question-container sub-question\">\n" +
                        "    <span class=\"my-editable my-editable-sub-title\">\n" +
                        "        <input type=\"text\" name=\"title\" class=\"text\">\n" +
                        "    </span>\n" +
                        "</div>"
                    );
                });
            });
        });
    }
}


function edtBtnFunc() {
    let id = this.id.slice(0,-8);
    console.log(id);
    /*点击了edit*/
    if($(this).html()==="Edit"){
        $("#"+id+"-row .my-editable").each(function (i) {
            var value = $(this).html();
            $(this).html("" +
                "<input type='text' name=\""+ namelist[i] +"\" class='text' value=\""+ value +"\">"
            );
        });
        /*QA naming*/
        var qa_namelist = ["title","choiceA","choiceB","choiceC","choiceD","std"];
        $("#"+id+"-question-row.obj-question-row .my-editable").each(function (i) {
            var value = $(this).html();
            $(this).html("" +
                "<input type='text' name=\""+ qa_namelist[i%6] +"\" class='text' value=\""+ value +"\">"
            );
        });
        /*QB naming*/
        var qb_namelist = ["title"];
        $("#"+id+"-question-row.sub-question-row .my-editable").each(function (i) {
            var value = $(this).html();
            $(this).html("" +
                "<input type='text' name=\""+ qb_namelist[i%1] +"\" class='text' value=\""+ value +"\">"
            );
        });
        /*button changing*/
        $("#"+id+"-row input[name='tid']").attr("readonly",true);
        $("#"+id+"-row input[name='type']").attr("readonly",true);
        $("#"+id+"-row [data-toggle='collapse']").attr("href","#");
        $("#"+id+"-question-form").attr({"readonly":true}).toggleClass("show",true).parent().attr({"colspan":4})
        $("#"+id+"-row .my-del-btn").hide();
        $("#"+id+"-question-list-add-btn").show();
        $(this).html("Save").toggleClass("bg-orange");
    }
    /*点击了save*/
    else {
        let json = {};
        /*test input*/
        $.each($("#"+id+"-row .my-editable"), function (i, item) {
            let input = item.children[0];
            json[input.getAttribute("name")] = input.value;
        });
        /*QA input*/
        let qa_list = [];
        let cnt = 0;
        $.each($("#"+id+"-question-row .obj-question"),function(){
            let qa_json = {};
            cnt++;
            $.each($(this).find(".my-editable"),function(j,item){
                let input = item.children[0];
                qa_json[input.getAttribute("name")] = input.value;
            });
            qa_list.push(qa_json);
        });
        json["QA"] = qa_list;
        /*QB input*/
        let qb_list = [];
        $.each($("#"+id+"-question-row .sub-question"),function(){
            let qb_json = {};
            $.each($(this).find(".my-editable"),function(j,item){
                let input = item.children[0];
                qb_json[input.getAttribute("name")] = input.value;
            });
            qb_list.push(qb_json);
        });
        json["QB"] = qb_list;
        json["uid"] = uid;
        json["cid"] = cid;
        if(qa_list.length===0){
            json["ttype"] = 1;
            json["cnt"] = qb_list.length;
        }
        else {
            json["ttype"] = 0;
            json["cnt"] = qa_list.length;
        }
        console.log(json);
        $.ajax({
            url:add_url+"?action=edit_user_list",
            type:"POST",
            data:json,
            success:function(data){
                alert("success");
                $.each($("#"+id+"-question-row .my-editable, #"+id+"-row .my-editable"), function (i, item) {
                    let input = item.children[0];
                    item.innerHTML=(input.value);
                });
                $("#"+id+"-row [data-toggle='collapse']").attr("href","#"+id+"-question-form");
                $("#"+id+"-question-form").parent().attr({"colspan":5});
                $("#"+id+"-row .my-edt-btn").html("Edit").toggleClass("bg-orange");
                $("#"+id+"-row .my-del-btn").show();
                $("#"+id+"-question-list-add-btn").hide();
                console.log(data);
                console.log("submited");
            },
            error:function(){
                alert("Connection error, item cannot be updated ,please try again later");
            }
        });
    }
}
function delBtnFunc() {
    let id = this.id.slice(0,-8);
    console.log(id);
    let json = {};
    $.each($("#"+id+"-row .my-editable"), function (i, item) {
        json[namelist[i]] = item.innerHTML.replace(/^\s+|\s+$/g,"");
    });
    console.log(json);
    $.ajax({
        url:del_url+"?action=delete_quiz_list&tid="+id,
        type:"GET",
        success:function(data){
            alert("success");
            $("#"+id+"-row").remove();
            $("#"+id+"-question-row").remove();
            console.log(data);
            console.log("deleted");
        },
        error:function(){
            alert("Connection error, please try again later");
        }
    });
}
function objQuestionAddBtn() {
    let tid = this.id.slice(0,-22);
    console.log(tid);
    $("#"+tid+"-question-list-add-btn").before("" +
        "<hr class=\"m-0 mx-3\">\n" +
        "<div class=\"card-body py-3 question-container obj-question\">\n" +
        "    <span class=\"my-editable my-editable-obj-title\">\n" +
        "        <input type=\"text\" name=\"title\" class=\"text\">\n" +
        "    </span>\n" +
        "    <div class=\" mt-2 choice-container\">\n" +
        "        <div class=\"my-editable my-editable-obj-choice\">\n" +
        "            <input type=\"text\" name=\"choiceA\" class=\"text\">\n" +
        "        </div>\n" +
        "        <div class=\"my-editable my-editable-obj-choice\">\n" +
        "            <input type=\"text\" name=\"choiceB\" class=\"text\">\n" +
        "        </div>\n" +
        "        <div class=\"my-editable my-editable-obj-choice\">\n" +
        "            <input type=\"text\" name=\"choiceC\" class=\"text\">\n" +
        "        </div>\n" +
        "        <div class=\"my-editable my-editable-obj-choice\">\n" +
        "            <input type=\"text\" name=\"choiceD\" class=\"text\">\n" +
        "        </div>\n" +
        "        <div class=\"mt-2 my-editable my-editable-obj-choice my-editable-obj-std\">\n" +
        "           <input type=\"text\" name=\"std\" class=\"text\">" +
        "       </div>"+
        "    </div>" +
        "</div>"
    );
}
function subQuestionAddBtn() {
    let tid = this.id.slice(0,-22);
    console.log(tid);
    $("#"+tid+"-question-list-add-btn").before("" +
        "<hr class=\"m-0 mx-3\">\n" +
        "<div class=\"card-body py-3 question-container sub-question\">\n" +
        "    <span class=\"my-editable my-editable-sub-title\">\n" +
        "        <input type=\"text\" name=\"title\" class=\"text\">\n" +
        "    </span>\n" +
        "</div>"
    );
}